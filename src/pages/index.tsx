import { prisma } from "@/server/db";
import { NotFound, REVALIDATE_IN_SECONDS } from "@/services/global";
import type { Category } from "@prisma/client";
import type { GetStaticProps, NextPage } from "next";
import Head from "next/head";
import Image from "next/image";
import Link from "next/link";
import NYCULogo from "/public/NYCU_logo.png";

type HomePageProps = {
  categories: Category[];
};

const Home: NextPage<HomePageProps> = ({ categories }) => {
  return (
    <>
      <Head>
        <title>Web Archive</title>
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className="container mx-auto flex h-screen flex-col items-center justify-center gap-10 font-serif">
        <Image className="h-32 w-32" src={NYCULogo} alt="NYCU Logo" />

        <div>
          <h1 className="text-5xl font-black">國立陽明交通大學網站典藏庫</h1>
          <h2 className="py-3 px-4 text-xl">
            National Yang Ming Chiao Tung University Web Archiving System
          </h2>
        </div>
        <div className="flex gap-16 px-4">
          {categories.map((category) => (
            <Link
              className="border-b border-ar-principal border-opacity-0 text-2xl transition duration-300 ease-in-out hover:border-opacity-100"
              href={`/category/${category.id}`}
              key={category.id}
            >
              {category.name}
            </Link>
          ))}
        </div>
      </main>
    </>
  );
};

export const getStaticProps: GetStaticProps<HomePageProps> = async () => {
  try {
    const categories = await prisma?.category.findMany();
    if (!categories) {
      return NotFound;
    }

    return {
      props: {
        categories,
      },
      revalidate: REVALIDATE_IN_SECONDS,
    };
  } catch (error) {
    return NotFound;
  }
};

export default Home;
